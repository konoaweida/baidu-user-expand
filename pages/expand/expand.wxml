<view class="expand-container">
  <navigation-header id="navHeader"></navigation-header>
  <view class="tabs-placeholder" style="height: 110rpx; width: 100%;"></view>

  <!-- 顶部Tab栏 -->
  <view class="tabs-container" style="top: {{navHeaderHeightRpx}}rpx;">
    <view 
      class="tab-item {{currentTab === 'recommend' ? 'active' : ''}} one"
      bindtap="handleTabClick"
      data-tab="recommend"
    >推荐</view>
    <view 
      class="tab-item {{currentTab === 'potential' ? 'active' : ''}} two"
      bindtap="handleTabClick"
      data-tab="potential"
    >潜在人脉</view>
    <view 
      class="filter-btn"
      wx:if="{{currentTab === 'potential'}}"
      bindtap="handleFilterClick"  
    ></view>
  </view>

  <!-- 内容滚动区域 -->
  <scroll-view 
    class="tab-content" 
    scroll-y="{{true}}"
    scroll-top="{{scrollTop[currentTab]}}"
    bindscroll="debouncedHandleScroll" 
    data-tab="{{currentTab}}"
    enhanced="{{true}}"  
    bounce="{{true}}"  
    scroll-with-animation="{{false}}"  
    style="height: calc(100vh - {{navHeaderHeightRpx}}rpx - 110rpx - env(safe-area-inset-bottom)); overflow-y: auto;"
  >
    <!-- 推荐Tab的正方形容器：简化事件绑定，确保点击能触发 -->
    <view class="content-recommend" wx:if="{{currentTab === 'recommend'}}">
      <view 
        class="search-container" 
        bindtap="triggerSearch"
      >
        <image src="" class="btn-gif" mode="widthFix"></image>
        <text class="btn-text">正在为您搜寻潜在人脉</text>
      </view>
    </view>

    <!-- 潜在人脉Tab：保留原空态提示 -->
    <view class="content-potential" wx:else>
      <view class="empty-state" wx:if="{{potentialEmpty}}">
        <text class="empty-text">无网络连接，请检查网络后重试</text>
      </view>
      <view wx:else>
        <!-- 顶部推荐人卡片滑动区（移入此处，仅当有数据时显示） -->
        <view class="top-cards-container" wx:if="{{topCandidates.length > 0}}">
          <scroll-view 
            class="cards-scroll"
            scroll-x="true"
            enable-flex="true"
            scroll-with-animation="true"
            show-scrollbar="false"
            style="height: 220rpx; padding: 16rpx 0;"
          >
            <!-- 外层替换为block，循环逻辑保留 -->
            <block 
              wx:for="{{topCandidates}}" 
              wx:key="id"
              data-id="{{item.id}}"
              bindtap="handleCardClick"
            >
              <!-- 内部view承载原card-item + card-inner的样式 -->
              <view class="card-item card-inner">
                <image class="card-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
                <view class="card-info">
                  <text class="card-name">{{item.name}}</text>
                  <text class="card-summary">{{item.summary}}</text>
                  <text class="card-mutual">{{item.mutualCount}}位共同</text>
                </view>
                <view class="card-close" bindtap="handleDismissCard" data-id="{{item.id}}">×</view>
              </view>
            </block>
          </scroll-view>
        </view>

        <!-- 原有潜在人脉列表（保留，与卡片区上下排布） -->
        <view class="potential-list">
          <view 
            class="content-item" 
            wx:for="{{potentialList}}" 
            wx:key="id"
          >
            潜在人脉{{item.name || item.id + 1}}
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
</view>