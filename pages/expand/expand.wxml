<view class="expand-container">
  <navigation-header id="navHeader"></navigation-header>
  <view class="tabs-placeholder" style="height: 110rpx; width: 100%;"></view>

  <!-- 顶部Tab栏 -->
  <view class="tabs-container" style="top: {{navHeaderHeightRpx}}rpx;">
    <view 
      class="tab-item {{currentTab === 'recommend' ? 'active' : ''}} one"
      bindtap="handleTabClick"
      data-tab="recommend"
    >推荐</view>
    <view 
      class="tab-item {{currentTab === 'potential' ? 'active' : ''}} two"
      bindtap="handleTabClick"
      data-tab="potential"
    >潜在人脉</view>
    <view 
      class="filter-btn"
      wx:if="{{currentTab === 'potential'}}"
      bindtap="handleFilterClick"  
    ></view>
  </view>

  <!-- 内容滚动区域 -->
  <scroll-view 
    class="tab-content" 
    scroll-y="{{true}}"
    scroll-top="{{scrollTop[currentTab]}}"
    data-tab="{{currentTab}}"
    enhanced="{{true}}"  
    bounce="{{false}}"  
    scroll-with-animation="{{true}}"  
    show-scrollbar="{{false}}"
    bindscroll="handleScroll"
    style="height: calc(100vh - {{navHeaderHeightRpx}}rpx - 110rpx - env(safe-area-inset-bottom)); overflow-y: auto;"
  >
    <!-- 推荐Tab：新增无网络提示，与搜寻容器互斥 -->
    <view class="content-recommend" wx:if="{{currentTab === 'recommend'}}">
      <!-- 无网络提示（wx:if控制，与search-container互斥） -->
      <view class="empty-state" wx:if="{{isNoNetwork}}">
        <text class="empty-text">无网络连接，请检查网络后重试</text>
      </view>
      
      <!-- 搜寻容器（有网络时显示，wx:else互斥） -->
      <view 
        class="search-container" 
        bindtap="triggerSearch"
        wx:else
      >
        <image src="" class="btn-gif" mode="widthFix"></image>
        <text class="btn-text">正在为您搜寻潜在人脉</text>
      </view>
    </view>

    <!-- 潜在人脉Tab：保留原空态提示 -->
    <view class="content-potential" wx:else>
      <view class="empty-state" wx:if="{{isNoNetwork}}">
        <text class="empty-text">无网络连接，请检查网络后重试</text>
      </view>
      <view wx:else>
        <!-- 顶部推荐人卡片滑动区（移入此处，仅当有数据时显示） -->
        <view class="top-cards-container" wx:if="{{topCandidates.length > 0}}">
          <scroll-view 
            class="cards-scroll"
            scroll-x="true"
            enable-flex="true"
            scroll-with-animation="true"
            enhanced="false"
            show-scrollbar="false"
          >
            <!-- ✅ 修改点：事件绑定从 block 移到 view -->
            <block wx:for="{{topCandidates}}" wx:key="id">
              <view 
                class="card-item" 
                bindtap="handleCardClick"
                data-id="{{item.id}}"
              >
                <image class="card-avatar" src="{{item.avatar}}" mode="aspectFill"></image>
                <view class="card-info">
                  <text class="card-name">{{item.name}}</text>
                  <text class="card-summary">{{item.summary}}</text>                
                </view>
                <!-- ✅ 关闭按钮保留 catchtap，不会影响外层点击 -->
                <view 
                  class="card-close" 
                  catchtap="handleDismissCard" 
                  data-id="{{item.id}}"
                >×</view>
              </view>
            </block>
          </scroll-view>
        </view>

        <!-- 原有潜在人脉列表（保留，与卡片区上下排布） -->
        <view class="potential-list" wx:if="{{potentialList.length > 0}}">
          <view 
            class="content-item" 
            wx:for="{{50}}" 
            wx:key="id"
          >
            潜在人脉{{item.name || item.id + 1}}
          </view>
        </view>
        <!-- 新增：有网络但无数据的提示（与无网络区分） -->
        <view class="empty-state" wx:if="{{potentialList.length === 0}}">
          <text class="empty-text">暂无潜在人脉数据</text>
        </view>
      </view>
    </view>
  </scroll-view>
</view>